# WXT 开发快速参考

## 🚀 快速开始

### 创建项目
```bash
# 创建新项目
npm create wxt@latest my-extension

# 进入项目目录
cd my-extension

# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

### 项目结构
```
my-extension/
├── entrypoints/          # 入口点目录
│   ├── background.ts     # 后台脚本
│   ├── content.ts        # 内容脚本
│   ├── popup/           # 弹窗页面
│   └── options/         # 设置页面
├── components/          # React 组件
├── utils/              # 工具函数
├── assets/             # 静态资源
├── wxt.config.ts       # WXT 配置
└── package.json
```

## 📋 常用命令

```bash
# 开发
npm run dev              # 启动开发服务器
npm run dev:firefox      # Firefox 开发模式

# 构建
npm run build            # 生产构建
npm run build:firefox    # Firefox 构建

# 打包
npm run zip              # 创建发布包
npm run zip:firefox      # Firefox 发布包

# 类型检查
npm run type-check       # TypeScript 类型检查

# 清理
npm run clean            # 清理构建文件
```

## ⚙️ 配置文件

### wxt.config.ts
```typescript
import { defineConfig } from 'wxt';

export default defineConfig({
  // 扩展清单配置
  manifest: {
    name: '我的扩展',
    description: '扩展描述',
    version: '1.0.0',
    permissions: ['activeTab', 'storage'],
    host_permissions: ['https://example.com/*'],
  },
  
  // 开发配置
  dev: {
    server: { port: 3000 }
  },
  
  // 构建配置
  build: {
    outDir: 'dist'
  },
  
  // Vite 配置
  vite: () => ({
    // 自定义 Vite 配置
  })
});
```

## 🧩 入口点开发

### Background Script
```typescript
// entrypoints/background.ts
export default defineBackground({
  main() {
    console.log('Background script started');
    
    // 监听扩展安装
    chrome.runtime.onInstalled.addListener(() => {
      console.log('Extension installed');
    });
    
    // 监听消息
    chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
      if (message.type === 'PING') {
        sendResponse({ type: 'PONG' });
      }
    });
  }
});
```

### Content Script
```typescript
// entrypoints/content.ts
export default defineContentScript({
  matches: ['https://example.com/*'],
  main() {
    console.log('Content script loaded');
    
    // 发送消息到 background
    chrome.runtime.sendMessage({ type: 'PING' });
    
    // 监听来自 popup 的消息
    chrome.runtime.onMessage.addListener((message) => {
      if (message.type === 'HIGHLIGHT') {
        // 高亮页面内容
        document.body.style.backgroundColor = 'yellow';
      }
    });
  }
});
```

### React 页面
```typescript
// entrypoints/popup/App.tsx
import React, { useState, useEffect } from 'react';

function App() {
  const [tabs, setTabs] = useState<chrome.tabs.Tab[]>([]);
  
  useEffect(() => {
    // 获取所有标签页
    chrome.tabs.query({}, (tabs) => {
      setTabs(tabs);
    });
  }, []);
  
  const closeTab = (tabId: number) => {
    chrome.tabs.remove(tabId);
    setTabs(tabs.filter(tab => tab.id !== tabId));
  };
  
  return (
    <div className="w-80 p-4">
      <h1 className="text-xl font-bold mb-4">标签页管理器</h1>
      <div className="space-y-2">
        {tabs.map(tab => (
          <div key={tab.id} className="flex items-center justify-between p-2 border rounded">
            <span className="truncate">{tab.title}</span>
            <button 
              onClick={() => closeTab(tab.id!)}
              className="text-red-500 hover:text-red-700"
            >
              ×
            </button>
          </div>
        ))}
      </div>
    </div>
  );
}

export default App;
```

## 🔧 常用 Hooks

### Chrome Storage Hook
```typescript
import { useState, useEffect } from 'react';

export function useChromeStorage<T>(key: string, defaultValue: T) {
  const [value, setValue] = useState<T>(defaultValue);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    chrome.storage.local.get([key]).then((result) => {
      setValue(result[key] ?? defaultValue);
      setLoading(false);
    });
  }, [key, defaultValue]);
  
  const updateValue = async (newValue: T) => {
    await chrome.storage.local.set({ [key]: newValue });
    setValue(newValue);
  };
  
  return [value, updateValue, loading] as const;
}
```

### Chrome Tabs Hook
```typescript
export function useChromeTabs() {
  const [tabs, setTabs] = useState<chrome.tabs.Tab[]>([]);
  
  useEffect(() => {
    const loadTabs = async () => {
      const tabs = await chrome.tabs.query({});
      setTabs(tabs);
    };
    
    loadTabs();
    
    // 监听标签页变化
    const handleCreated = (tab: chrome.tabs.Tab) => {
      setTabs(prev => [...prev, tab]);
    };
    
    const handleRemoved = (tabId: number) => {
      setTabs(prev => prev.filter(tab => tab.id !== tabId));
    };
    
    chrome.tabs.onCreated.addListener(handleCreated);
    chrome.tabs.onRemoved.addListener(handleRemoved);
    
    return () => {
      chrome.tabs.onCreated.removeListener(handleCreated);
      chrome.tabs.onRemoved.removeListener(handleRemoved);
    };
  }, []);
  
  return tabs;
}
```

## 🎨 Tailwind CSS 常用类

### 布局
```css
/* Flexbox */
.flex .items-center .justify-between
.flex-col .flex-row .flex-wrap

/* Grid */
.grid .grid-cols-2 .grid-cols-3 .gap-4

/* 间距 */
.p-4 .px-6 .py-2 .m-4 .mx-auto .space-y-2

/* 尺寸 */
.w-full .h-screen .max-w-md .min-h-0
```

### 样式
```css
/* 颜色 */
.bg-blue-500 .text-white .border-gray-300

/* 字体 */
.text-lg .font-bold .leading-relaxed

/* 圆角和阴影 */
.rounded-lg .shadow-md .shadow-lg

/* 状态 */
.hover:bg-blue-600 .focus:ring-2 .disabled:opacity-50
```

## 📱 常用组件模式

### 按钮组件
```typescript
interface ButtonProps {
  variant?: 'primary' | 'secondary';
  size?: 'sm' | 'md' | 'lg';
  children: React.ReactNode;
  onClick?: () => void;
}

const Button: React.FC<ButtonProps> = ({ 
  variant = 'primary', 
  size = 'md', 
  children, 
  onClick 
}) => {
  const baseClasses = 'inline-flex items-center justify-center font-medium rounded-md transition-colors';
  const variantClasses = {
    primary: 'bg-blue-600 text-white hover:bg-blue-700',
    secondary: 'bg-gray-200 text-gray-900 hover:bg-gray-300'
  };
  const sizeClasses = {
    sm: 'px-3 py-1.5 text-sm',
    md: 'px-4 py-2 text-sm',
    lg: 'px-6 py-3 text-base'
  };
  
  return (
    <button 
      className={`${baseClasses} ${variantClasses[variant]} ${sizeClasses[size]}`}
      onClick={onClick}
    >
      {children}
    </button>
  );
};
```

### 输入框组件
```typescript
interface InputProps {
  label?: string;
  placeholder?: string;
  value: string;
  onChange: (value: string) => void;
}

const Input: React.FC<InputProps> = ({ label, placeholder, value, onChange }) => {
  return (
    <div>
      {label && (
        <label className="block text-sm font-medium text-gray-700 mb-1">
          {label}
        </label>
      )}
      <input
        type="text"
        placeholder={placeholder}
        value={value}
        onChange={(e) => onChange(e.target.value)}
        className="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
      />
    </div>
  );
};
```

## 🔍 调试技巧

### Background Script 调试
```typescript
// 在 background script 中
console.log('Debug info:', data);

// 查看调试信息
// 1. 打开 chrome://extensions/
// 2. 找到你的扩展
// 3. 点击 "检查视图: 背景页"
```

### Content Script 调试
```typescript
// 在 content script 中
console.log('Content script debug:', data);

// 查看调试信息
// 1. 打开目标网页
// 2. 按 F12 打开开发者工具
// 3. 在 Console 中查看输出
```

### Popup 调试
```typescript
// 在 popup 组件中
console.log('Popup debug:', data);

// 查看调试信息
// 1. 右键点击扩展图标
// 2. 选择 "检查"
// 3. 在弹出的开发者工具中查看
```

## 📦 打包发布

### 生产构建
```bash
# 构建生产版本
npm run build

# 创建 ZIP 包
npm run zip

# 构建输出目录
.output/chrome-mv3/
├── manifest.json
├── popup.html
├── options.html
├── background.js
├── content-scripts/
└── assets/
```

### Chrome Web Store 发布
1. 访问 [Chrome 开发者控制台](https://chrome.google.com/webstore/devconsole/)
2. 创建新的扩展项目
3. 上传 ZIP 包
4. 填写扩展信息
5. 提交审核

## 🐛 常见问题

### 权限错误
```typescript
// 错误：Unchecked runtime.lastError
// 解决：检查权限配置
{
  "permissions": ["activeTab", "storage", "tabs"]
}
```

### 热重载不工作
```bash
# 重启开发服务器
npm run dev

# 或者重新加载扩展
# 在 chrome://extensions/ 中点击刷新图标
```

### TypeScript 类型错误
```typescript
// 安装 Chrome 类型定义
npm install -D @types/chrome

// 在 tsconfig.json 中添加
{
  "types": ["chrome"]
}
```

### CSS 样式不生效
```typescript
// 检查 Content Security Policy
// 在 manifest 中确保 CSS 文件被正确引用
// 避免使用内联样式
```

## 📚 参考资源

- [WXT 官方文档](https://wxt.dev/)
- [Chrome 扩展开发文档](https://developer.chrome.com/docs/extensions/)
- [React 官方文档](https://react.dev/)
- [Tailwind CSS 文档](https://tailwindcss.com/)
- [TypeScript 文档](https://www.typescriptlang.org/)

---

这个快速参考涵盖了 WXT 扩展开发的核心内容，建议收藏备用！🚀
